<mat-card>
  <mat-card-header>
    <mat-card-title>Téléchargement de factures</mat-card-title>
    <mat-card-subtitle>Téléchargez vos factures pour traitement automatique</mat-card-subtitle>
  </mat-card-header>
  
  <mat-card-content>
    <div class="upload-area" 
         [class.drag-over]="dragOver" 
         (dragover)="dragOver=true; $event.preventDefault();" 
         (dragleave)="dragOver=false" 
         (drop)="dragOver=false; onFileSelected($event); $event.preventDefault();">
      
      <mat-icon class="upload-icon">cloud_upload</mat-icon>
      <p>Glissez et déposez votre facture ici ou</p>
      
      <div class="file-input-container">
        <input type="file" id="file" (change)="onFileSelected($event)" accept=".pdf,.jpg,.jpeg,.png" #fileInput hidden>
        <button mat-raised-button color="primary" (click)="fileInput.click();structuredData=null">
          <mat-icon>attach_file</mat-icon>
          Sélectionner un fichier
        </button>
      </div>
      
      <p *ngIf="selectedFile" class="selected-file">
        Fichier sélectionné: {{ selectedFile.name }}
      </p>
    </div>
    
    <!-- Données structurées -->
    <div *ngIf="structuredData" class="structured-data-container">
      <h3>Données extraites</h3>
      
      <!-- Données principales -->
      <div class="main-data-container">
        <div *ngIf="jsonOutput?.numeroFacture" class="main-data-item">
          <div class="main-data-icon">
            <mat-icon>receipt</mat-icon>
          </div>
          <div class="main-data-content">
            <div class="main-data-label">Numéro de facture</div>
            <div class="main-data-value">{{ jsonOutput.numeroFacture }}</div>
          </div>
        </div>
        
        <div *ngIf="jsonOutput?.datePiece" class="main-data-item">
          <div class="main-data-icon">
            <mat-icon>event</mat-icon>
          </div>
          <div class="main-data-content">
            <div class="main-data-label">Date</div>
            <div class="main-data-value">{{ jsonOutput.datePiece }}</div>
          </div>
        </div>
        
        <div *ngIf="jsonOutput?.totalTTC" class="main-data-item">
          <div class="main-data-icon">
            <mat-icon>euro_symbol</mat-icon>
          </div>
          <div class="main-data-content">
            <div class="main-data-label">Montant total TTC</div>
            <div class="main-data-value">{{ jsonOutput.totalTTC }} €</div>
          </div>
        </div>
      </div>
      
      <!-- Informations client -->
      <div *ngIf="jsonOutput?.client" class="category-section">
        <div class="category-header" style="borderLeftColor: #4CAF50">
          <mat-icon style="color: #4CAF50">business</mat-icon>
          <h4>Informations client</h4>
        </div>
        
        <div class="structured-data-grid">
          <div *ngIf="jsonOutput.client.societe" class="data-item">
            <div class="data-label">Société</div>
            <div class="data-value">{{ jsonOutput.client.societe }}</div>
          </div>
          <div *ngIf="jsonOutput.client.code" class="data-item">
            <div class="data-label">Code client</div>
            <div class="data-value">{{ jsonOutput.client.code }}</div>
          </div>
          <div *ngIf="jsonOutput.client.tva" class="data-item">
            <div class="data-label">TVA</div>
            <div class="data-value">{{ jsonOutput.client.tva }}</div>
          </div>
          <div *ngIf="jsonOutput.client.siret" class="data-item">
            <div class="data-label">SIRET</div>
            <div class="data-value">{{ jsonOutput.client.siret }}</div>
          </div>
          <div *ngIf="jsonOutput.client.ville" class="data-item">
            <div class="data-label">Ville</div>
            <div class="data-value">{{ jsonOutput.client.ville }}</div>
          </div>
          <div *ngIf="jsonOutput.client.pays" class="data-item">
            <div class="data-label">Pays</div>
            <div class="data-value">{{ jsonOutput.client.pays }}</div>
          </div>
        </div>
      </div>
      
      <!-- Champs catégorisés -->
      <div *ngFor="let category of categoryOrder">
        <div *ngIf="hasCategoryFields(category)" class="category-section">
          <div class="category-header" [style.borderLeftColor]="categories[category].color">
            <mat-icon [style.color]="categories[category].color">{{ categories[category].icon }}</mat-icon>
            <h4>{{ categories[category].title }}</h4>
          </div>
          
          <div class="structured-data-grid">
            <div *ngFor="let field of categorizedFields[category]" class="data-item">
              <div class="data-label">{{ field.key }}</div>
              <div class="data-value">{{ field.value }}</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Lignes de produits -->
      <div *ngIf="jsonOutput?.articles && jsonOutput.articles.length > 0" class="category-section">
        <div class="category-header" style="borderLeftColor: #FF9800">
          <mat-icon style="color: #FF9800">shopping_cart</mat-icon>
          <h4>Articles</h4>
        </div>
        
        <table class="articles-table">
          <thead>
            <tr>
              <th>Désignation</th>
              <th>Quantité</th>
              <th>Prix HT</th>
              <th>Remise</th>
              <th>Total HT</th>
              <th>Total TTC</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let article of jsonOutput.articles">
              <td>{{ article.nom }}</td>
              <td>{{ article.quantite }}</td>
              <td>{{ article.prixHT }} €</td>
              <td>{{ article.remise }}</td>
              <td>{{ article.totalHT }} €</td>
              <td>{{ article.totalTTC }} €</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Format JSON complet -->
      <div class="category-section">
        <div class="category-header" style="borderLeftColor: #2196F3">
          <mat-icon style="color: #2196F3">code</mat-icon>
          <h4>Format JSON</h4>
        </div>
        
        <pre class="json-output">{{ jsonOutput | json }}</pre>
      </div>
    </div>
  </mat-card-content>
  
  <mat-card-actions align="end">
    <button mat-raised-button color="accent" (click)="onUpload()" [disabled]="!selectedFile || isUploading">
      <mat-icon>upload</mat-icon>
      {{ isUploading ? 'Téléchargement en cours...' : 'Télécharger' }}
    </button>
  </mat-card-actions>
  
  <mat-card-footer *ngIf="isUploading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </mat-card-footer>
</mat-card>