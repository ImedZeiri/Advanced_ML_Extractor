<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end" class="pdf-sidenav">
    <div class="sidenav-header">
      <h2>Facture originale</h2>
      <button mat-icon-button (click)="sidenav.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="pdf-container" *ngIf="pdfUrl">
      <iframe [src]="pdfUrl | safe" width="100%" height="100%" frameborder="0"></iframe>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-card>
      <mat-card-header>
        <mat-card-title>Téléchargement de factures</mat-card-title>
        <mat-card-subtitle>Téléchargez vos factures pour traitement automatique</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="upload-area" 
             [class.drag-over]="dragOver" 
             (dragover)="dragOver=true; $event.preventDefault();" 
             (dragleave)="dragOver=false" 
             (drop)="dragOver=false; onFileSelected($event); $event.preventDefault();">
          
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <p>Glissez et déposez votre facture ici ou</p>
          
          <div class="file-input-container">
            <input type="file" id="file" (change)="onFileSelected($event)" accept=".pdf,.jpg,.jpeg,.png" #fileInput hidden>
            <button mat-raised-button color="primary" (click)="fileInput.click();structuredData=null">
              <mat-icon>attach_file</mat-icon>
              Sélectionner un fichier
            </button>
          </div>
          
          <p *ngIf="selectedFile" class="selected-file">
            Fichier sélectionné: {{ selectedFile.name }}
          </p>
        </div>
        
        <!-- Données structurées -->
        <div *ngIf="structuredData" class="structured-data-container">
          <div class="extraction-success-header">
            <h3>Données extraites avec succès</h3>
            <button mat-raised-button color="accent" *ngIf="pdfUrl" (click)="sidenav.open()">
              <mat-icon>description</mat-icon>
              Voir la facture originale
            </button>
          </div>
          
          <!-- Données principales -->
          <div class="main-data-container">
            <div class="main-data-item">
              <div class="main-data-icon">
                <mat-icon>receipt</mat-icon>
              </div>
              <div class="main-data-content">
                <div class="main-data-label">Numéro de facture</div>
                <div class="main-data-value">{{ structuredData.numeroFacture || 'Non détecté' }}</div>
              </div>
            </div>
            
            <div class="main-data-item">
              <div class="main-data-icon">
                <mat-icon>shopping_cart</mat-icon>
              </div>
              <div class="main-data-content">
                <div class="main-data-label">Numéro de commande</div>
                <div class="main-data-value">{{ structuredData.numeroCommande || 'Non détecté' }}</div>
              </div>
            </div>
            
            <div class="main-data-item">
              <div class="main-data-icon">
                <mat-icon>description</mat-icon>
              </div>
              <div class="main-data-content">
                <div class="main-data-label">Numéro de contrat</div>
                <div class="main-data-value">{{ structuredData.numeroContrat || 'Non détecté' }}</div>
              </div>
            </div>
          </div>
          
          <!-- Dates -->
          <div class="data-section">
            <h4 class="section-title">Dates</h4>
            <div class="data-content">
              <div class="data-item">
                <div class="data-label">Date de pièce</div>
                <div class="data-value">{{ structuredData.datePiece || 'Non détectée' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Date de commande</div>
                <div class="data-value">{{ structuredData.dateCommande || 'Non détectée' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Date de livraison</div>
                <div class="data-value">{{ structuredData.dateLivraison || 'Non détectée' }}</div>
              </div>
            </div>
          </div>
          
          <!-- Informations client -->
          <div class="data-section">
            <h4 class="section-title">Informations client</h4>
            <div class="data-content">
              <div class="data-item">
                <div class="data-label">Société</div>
                <div class="data-value">{{ structuredData.client.societe || 'Non détectée' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Code client</div>
                <div class="data-value">{{ structuredData.client.code || 'Non détecté' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">TVA</div>
                <div class="data-value">{{ structuredData.client.tva || 'Non détectée' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">SIRET</div>
                <div class="data-value">{{ structuredData.client.siret || 'Non détecté' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Ville</div>
                <div class="data-value">{{ structuredData.client.ville || 'Non détectée' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Pays</div>
                <div class="data-value">{{ structuredData.client.pays || 'Non détecté' }}</div>
              </div>
            </div>
          </div>
          
          <!-- Montants -->
          <div class="data-section">
            <h4 class="section-title">Montants</h4>
            <div class="data-content">
              <div class="data-item">
                <div class="data-label">Total HT</div>
                <div class="data-value">{{ structuredData.totalHT ? (structuredData.totalHT + ' €') : 'Non détecté' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Total TVA</div>
                <div class="data-value">{{ structuredData.totalTVA ? (structuredData.totalTVA + ' €') : 'Non détecté' }}</div>
              </div>
              <div class="data-item">
                <div class="data-label">Total TTC</div>
                <div class="data-value">{{ structuredData.totalTTC ? (structuredData.totalTTC + ' €') : 'Non détecté' }}</div>
              </div>
            </div>
          </div>
          
          <!-- Articles -->
          <div class="data-section" *ngIf="structuredData.articles && structuredData.articles.length > 0">
            <h4 class="section-title">Articles</h4>
            <div class="articles-container">
              <table mat-table [dataSource]="structuredData.articles" class="articles-table">
                <!-- Nom Column -->
                <ng-container matColumnDef="nom">
                  <th mat-header-cell *matHeaderCellDef>Nom</th>
                  <td mat-cell *matCellDef="let article">{{ article.nom || 'Non spécifié' }}</td>
                </ng-container>
                
                <!-- Quantité Column -->
                <ng-container matColumnDef="quantite">
                  <th mat-header-cell *matHeaderCellDef>Quantité</th>
                  <td mat-cell *matCellDef="let article">{{ article.quantite || 'Non spécifié' }}</td>
                </ng-container>
                
                <!-- Prix HT Column -->
                <ng-container matColumnDef="prixHT">
                  <th mat-header-cell *matHeaderCellDef>Prix HT</th>
                  <td mat-cell *matCellDef="let article">{{ article.prixHT ? (article.prixHT + ' €') : 'Non spécifié' }}</td>
                </ng-container>
                
                <!-- Remise Column -->
                <ng-container matColumnDef="remise">
                  <th mat-header-cell *matHeaderCellDef>Remise</th>
                  <td mat-cell *matCellDef="let article">{{ article.remise ? (article.remise + ' €') : 'Non spécifié' }}</td>
                </ng-container>
                
                <!-- Total HT Column -->
                <ng-container matColumnDef="totalHT">
                  <th mat-header-cell *matHeaderCellDef>Total HT</th>
                  <td mat-cell *matCellDef="let article">{{ article.totalHT ? (article.totalHT + ' €') : 'Non spécifié' }}</td>
                </ng-container>
                
                <!-- Total TTC Column -->
                <ng-container matColumnDef="totalTTC">
                  <th mat-header-cell *matHeaderCellDef>Total TTC</th>
                  <td mat-cell *matCellDef="let article">{{ article.totalTTC ? (article.totalTTC + ' €') : 'Non spécifié' }}</td>
                </ng-container>
                
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>
          </div>
          
          <div class="data-section" *ngIf="!structuredData.articles || structuredData.articles.length === 0">
            <h4 class="section-title">Articles</h4>
            <div class="no-articles">
              <p>Aucun article détecté</p>
            </div>
          </div>
        </div>
      </mat-card-content>
      
      <mat-card-actions align="end">
        <button mat-raised-button color="accent" (click)="onUpload()" [disabled]="!selectedFile || isUploading">
          <mat-icon>upload</mat-icon>
          {{ isUploading ? 'Téléchargement en cours...' : 'Télécharger' }}
        </button>
      </mat-card-actions>
      
      <mat-card-footer *ngIf="isUploading">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </mat-card-footer>
    </mat-card>
  </mat-sidenav-content>
</mat-sidenav-container>